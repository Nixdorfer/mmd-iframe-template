<div class="iFR"><img src="" onerror='
(function(c, p) {
	var base = "https://raw.githubusercontent.com/Nixdorfer/mmd-iframe-template/refs/heads/main/", o, f, mH;
	c.style.position = "relative";
	var b = document.createElement("button");
	b.style.cssText = "padding:12px 24px;background:#b8860b;border:none;border-radius:8px;color:#fff;cursor:not-allowed;font-size:14px";
	b.textContent = "加载中...";
	b.disabled = true;
	c.appendChild(b);
	function sI() {
		o.style.display = "flex";
		f.style.width = "100vw";
		f.style.height = "100vh";
		f.style.opacity = "0";
		f.style.transform = "translateY(-30px)";
		setTimeout(function() {
			f.style.opacity = "1";
			f.style.transform = "translateY(0)";
		}, 10);
	}
	function hI() {
		f.style.opacity = "0";
		setTimeout(function() {
			o.style.display = "none";
			f.style.width = "0";
			f.style.height = "0";
		}, 400);
	}
	function sU(h) {
		var rId = new URLSearchParams(location.search).get("roleId") || "";
		var ht = h.replace("/*__INJECT__*/", "window.P=" + JSON.stringify(p) + ";window.R=\"" + window.innerWidth + "x" + window.innerHeight + "\";window.ROLEID=\"" + rId + "\";");
		o = document.createElement("div");
		o.style.cssText = "position:fixed;top:0;left:0;width:100vw;height:100vh;background:#242424;z-index:99999;display:none;align-items:center;justify-content:center";
		f = document.createElement("iframe");
		f.style.cssText = "width:0;height:0;border:none;opacity:0;transform:translateY(-30px);transition:opacity 0.4s,transform 0.4s";
		f.srcdoc = ht;
		o.appendChild(f);
		document.body.appendChild(o);
		mH = function(ev) {
			if (!ev.data || !ev.data.t) return;
			var KEY = "editorGallery", st, items, maxId, idx;
			switch (ev.data.t) {
				case "cancel": hI(); break;
				case "unload":
					document.body.innerHTML = "";
					f.style.cssText = "width:100vw;height:100vh;border:none;position:fixed;top:0;left:0;z-index:99999";
					document.body.appendChild(f);
					break;
				case "error":
					o.remove();
					b.remove();
					var d = document.createElement("div");
					d.style.cssText = "padding:16px;background:#8b0000;border-radius:8px;color:#fff;font-size:14px";
					d.textContent = ev.data.msg;
					c.appendChild(d);
					break;
				case "done":
					var a = document.querySelector(".chat .chat-bottom .uni-textarea .chat-input-scope textarea");
					if (a) {
						a.focus();
						a.value = ev.data.msg;
						a.dispatchEvent(new Event("input", {bubbles: true}));
					}
					hI();
					break;
				case "store:load":
					st = localStorage.getItem(KEY);
					f.contentWindow.postMessage({t: "store:data", items: st ? JSON.parse(st) : []}, "*");
					break;
				case "store:add":
					st = localStorage.getItem(KEY);
					items = st ? JSON.parse(st) : [];
					maxId = items.reduce(function(m, i) { return Math.max(m, i.id || 0); }, 0);
					ev.data.item.id = maxId + 1;
					items.push(ev.data.item);
					localStorage.setItem(KEY, JSON.stringify(items));
					f.contentWindow.postMessage({t: "store:added", id: ev.data.item.id}, "*");
					break;
				case "store:put":
					st = localStorage.getItem(KEY);
					items = st ? JSON.parse(st) : [];
					idx = items.findIndex(function(i) { return i.id === ev.data.item.id; });
					if (idx > -1) items[idx] = ev.data.item;
					localStorage.setItem(KEY, JSON.stringify(items));
					f.contentWindow.postMessage({t: "store:updated"}, "*");
					break;
				case "store:delete":
					st = localStorage.getItem(KEY);
					items = st ? JSON.parse(st) : [];
					items = items.filter(function(i) { return i.id !== ev.data.id; });
					localStorage.setItem(KEY, JSON.stringify(items));
					f.contentWindow.postMessage({t: "store:deleted"}, "*");
					break;
			}
		};
		window.addEventListener("message", mH);
		b.onclick = sI;
		sI();
	}
	fetch(base + "library/loader.html").then(function(r) {
		if (!r.ok) throw 0;
		return r.text();
	}).then(function(h) {
		b.disabled = false;
		b.style.background = "#166d3b";
		b.style.cursor = "pointer";
		b.textContent = "打开";
		sU(h);
	}).catch(function() {
		b.disabled = false;
		b.style.background = "#8b0000";
		b.style.cursor = "pointer";
		b.textContent = "加载失败";
		b.onclick = function() {
			location.reload();
		};
	});
})(this.closest(".iFR"), "$1")
'></div>