<div class="iFrEdt"><img src="" onerror='
(function(c, p) {
	var base = "https://raw.githubusercontent.com/Nixdorfer/mmd-iframe-template/refs/heads/main/", o, f, mH, unloaded = false;
	c.style.position = "relative";
	var b = document.createElement("button");
	b.style.cssText = "padding:12px 24px;background:#b8860b;border:none;border-radius:8px;color:#fff;cursor:not-allowed;font-size:16px;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif";
	b.textContent = "加载中...";
	b.disabled = true;
	c.appendChild(b);
	function TA() {
		return document.querySelector(".chat .chat-bottom .uni-textarea .chat-input-scope textarea");
	}
	function SEND() {
		return document.querySelector(".chat .chat-bottom .uni-textarea .chat-input-scope uni-image.btn-icon");
	}
	function sI() {
		o.style.display = "flex";
		f.style.width = "100vw";
		f.style.height = "100vh";
		f.style.opacity = "0";
		f.style.transform = "translateY(-30px)";
		setTimeout(function() {
			f.style.opacity = "1";
			f.style.transform = "translateY(0)";
		}, 10);
	}
	function hI() {
		f.style.opacity = "0";
		f.style.transform = "translateY(-30px)";
		setTimeout(function() {
			o.style.display = "none";
			f.style.width = "0";
			f.style.height = "0";
		}, 400);
	}
	function cleanup() {
		window.removeEventListener("message", mH);
		if (o) o.remove();
		c.remove();
	}
	function showError(msg) {
		cleanup();
		var d = document.createElement("div");
		d.className = "iFrEdt";
		d.style.cssText = "padding:16px;background:#8b0000;border:none;border-radius:8px;color:#fff;font-size:16px;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif";
		d.textContent = msg || "加载失败";
		if (c.parentNode) c.parentNode.insertBefore(d, c);
	}
	function sU(h) {
		var rId = new URLSearchParams(location.search).get("roleId") || "";
		var pB64 = btoa(unescape(encodeURIComponent(p)));
		var ht = h.replace("/*__INJECT__*/", "window.PB64=\"" + pB64 + "\";window.R=\"" + window.innerWidth + "x" + window.innerHeight + "\";window.ROLEID=\"" + rId + "\";");
		o = document.createElement("div");
		o.style.cssText = "position:fixed;top:0;left:0;width:100vw;height:100vh;background:#242424;z-index:99999;display:none;align-items:center;justify-content:center";
		f = document.createElement("iframe");
		f.style.cssText = "width:0;height:0;border:none;opacity:0;transform:translateY(-30px);transition:opacity 0.4s,transform 0.4s";
		f.srcdoc = ht;
		o.appendChild(f);
		document.body.appendChild(o);
		var sH = window.initStore ? window.initStore(f) : null;
		mH = function(ev) {
			if (!ev.data || !ev.data.t) return;
			var t = ev.data.t;
			var a, btn;
			switch (t) {
				case "input":
					a = TA();
					if (a) {
						a.focus();
						a.value += ev.data.msg || "";
						a.dispatchEvent(new Event("input", {bubbles: true}));
					}
					break;
				case "clear":
					a = TA();
					if (a) {
						a.focus();
						a.value = "";
						a.dispatchEvent(new Event("input", {bubbles: true}));
					}
					break;
				case "set":
					a = TA();
					if (a) {
						a.focus();
						a.value = ev.data.msg || "";
						a.dispatchEvent(new Event("input", {bubbles: true}));
					}
					break;
				case "send":
					btn = SEND();
					if (btn) btn.click();
					break;
				case "done":
					if (!unloaded) cleanup();
					break;
				case "hide":
					if (!unloaded) hI();
					break;
				case "show":
					if (!unloaded) sI();
					break;
				case "unload":
					unloaded = true;
					var chatBottom = document.querySelector(".chat .chat-bottom");
					document.body.innerHTML = "";
					if (chatBottom) document.body.appendChild(chatBottom);
					f.style.cssText = "width:100vw;height:100vh;border:none;position:fixed;top:0;left:0;z-index:99999";
					document.body.appendChild(f);
					break;
				case "error":
					showError(ev.data.msg);
					break;
				case "complete":
					cleanup();
					var d = document.createElement("div");
					d.className = "iFrEdt";
					d.style.cssText = "padding:16px;background:#166d3b;border:none;border-radius:8px;color:#fff;font-size:16px;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif";
					d.textContent = ev.data.msg || "操作已完成";
					if (c.parentNode) c.parentNode.insertBefore(d, c);
					break;
				default:
					if (sH) sH(ev);
			}
		};
		window.addEventListener("message", mH);
		b.onclick = sI;
		sI();
	}
	Promise.all([
		fetch(base + "loader/loader.html").then(function(r) { return r.ok ? r.text() : Promise.reject(); }),
		fetch(base + "library/store.js").then(function(r) { return r.ok ? r.text() : ""; })
	]).then(function(r) {
		b.disabled = false;
		b.style.background = "#166d3b";
		b.style.cursor = "pointer";
		b.textContent = "打开";
		if (r[1]) new Function(r[1])();
		sU(r[0]);
	}).catch(function() {
		b.disabled = false;
		b.style.background = "#8b0000";
		b.style.cursor = "pointer";
		b.textContent = "加载失败";
		b.onclick = function() { location.reload(); };
	});
})(this.closest(".iFrEdt"), "$1")
'></div>
