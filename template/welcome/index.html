<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:var(--bg);color:#fff;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
.container{background:var(--modal);border-radius:16px;max-width:500px;width:90%;max-height:90vh;display:flex;flex-direction:column;box-shadow:0 10px 40px rgba(0,0,0,0.3)}
.modal-header{padding:24px 24px 16px;text-align:center;flex-shrink:0}
.modal-header h1{color:#fff;margin:0}
.modal-content{flex:1;overflow-y:auto;padding:0 24px;scrollbar-width:thin;scrollbar-color:rgba(0,0,0,0.5) transparent}
.modal-content::-webkit-scrollbar{width:6px;background:transparent}
.modal-content::-webkit-scrollbar-track{background:transparent}
.modal-content::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.5);border-radius:3px}
.modal-footer{padding:16px 24px 24px;flex-shrink:0;display:flex;gap:10px}
.desc{color:#888;font-size:14px;margin-bottom:16px;white-space:pre-wrap}
.desc.align-left{text-align:left}.desc.align-right{text-align:right}.desc.align-middle{text-align:center}
.desc.style-quote{border-left:3px solid #444;padding-left:12px;color:#aaa;font-style:italic}
.desc.style-title{font-size:18px;font-weight:bold;color:#fff}
.desc.style-bold{font-weight:bold}
.desc.style-tilt{font-style:italic}
.desc.style-underline{text-decoration:underline}
.desc.style-delete{text-decoration:line-through}
.desc.style-url{color:#4a9eff;text-decoration:underline;cursor:pointer}
.desc.no-enter{display:inline;margin-bottom:0}
.url-confirm{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:10000}
.url-confirm-box{background:#1a1a1a;border-radius:12px;padding:20px;max-width:360px;width:90%}
.url-confirm-title{color:#fff;font-size:16px;font-weight:bold;margin-bottom:12px}
.url-confirm-link{color:#4a9eff;font-size:13px;word-break:break-all;margin-bottom:8px}
.url-confirm-warn{color:#ff6b6b;font-size:12px;margin-bottom:16px}
.url-confirm-btns{display:flex;justify-content:flex-end;gap:10px}
.url-confirm-btns button{padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-size:14px}
.url-confirm-close{background:#333;color:#888}
.url-confirm-ok{background:var(--btn);color:#fff}
.form-group{margin-bottom:16px}
label{display:block;margin-bottom:8px;color:#fff}
input,select{width:100%;padding:12px;border:none;border-radius:8px;background:#1a1a1a;color:#fff;font-size:16px}
input:focus,select:focus{outline:2px solid var(--btn)}
.btn{flex:1;padding:14px;border:none;border-radius:8px;font-size:16px;cursor:pointer;transition:all 0.3s}
.btn-primary{background:var(--btn);color:#fff}
.btn-primary:hover{filter:brightness(1.2)}
.btn-secondary{background:#333;color:#888}
.btn-secondary:hover{background:#444}
.btn-prev{background:var(--btn);color:#fff}
.btn-prev:hover{filter:brightness(1.2)}
.hidden{display:none}
@keyframes aSlide{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes aFade{from{opacity:0}to{opacity:1}}
@keyframes aRotate{from{transform:rotate(-180deg) scale(0);opacity:0}to{transform:rotate(0) scale(1);opacity:1}}
@keyframes aZoomin{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes aZoomout{from{transform:scale(2);opacity:0}to{transform:scale(1);opacity:1}}
.anim-slide{animation:aSlide var(--dur) ease-out}
.anim-fade{animation:aFade var(--dur) ease-out}
.anim-rotate{animation:aRotate var(--dur) ease-out}
.anim-zoomin{animation:aZoomin var(--dur) ease-out}
.anim-zoomout{animation:aZoomout var(--dur) ease-out}
</style>
</head>
<body>
<div class="container" id="root"></div>
<script>
/*__CONFIG__*/
(function() {
var C = window.CONFIG || {};
var CK = window.CONFIG_KEYS || [];
var modalColor = C.modalColor || '0d0d0d';
var btnColor = C.btnColor || '166d3b';
var bgColor = C.backgroundColor || '050505';
var globalAlign = C['page.content.align'] || 'middle';
var globalStyle = C['page.content.style'] || '';
document.documentElement.style.setProperty('--bg', '#'+bgColor);
document.documentElement.style.setProperty('--modal', '#'+modalColor);
document.documentElement.style.setProperty('--btn', '#'+btnColor);
var pages = [];
var pageKeys = Object.keys(C).filter(function(k){return k.match(/^page\.\d+\./);});
var pageNums = [];
pageKeys.forEach(function(k) {
  var n = parseInt(k.split('.')[1]);
  if (pageNums.indexOf(n) === -1) pageNums.push(n);
});
pageNums.sort(function(a,b){return a-b;});
function getKeyOrder(k) {
  var idx = CK.indexOf(k);
  return idx >= 0 ? idx : 9999;
}
pageNums.forEach(function(n) {
  var pg = {n:n, title:'', elements:[], nextContent:'', lastContent:'', hideContent:'', bgColor:'', modalColor:'', btnColor:'', defaultAlign:'', defaultStyle:'', animType:'', animDur:300};
  pg.title = C['page.'+n+'.title'] || '';
  pg.defaultAlign = C['page.'+n+'.content.align'] || '';
  pg.defaultStyle = C['page.'+n+'.content.style'] || '';
  pg.nextContent = C['page.'+n+'.next.content'] || '';
  pg.lastContent = C['page.'+n+'.last.content'] || '上一页';
  pg.hideContent = C['page.'+n+'.hide.content'] || '隐藏';
  pg.bgColor = C['page.'+n+'.background.color'] || '';
  pg.modalColor = C['page.'+n+'.modal.color'] || '';
  pg.btnColor = C['page.'+n+'.btn.color'] || '';
  pg.animType = C['page.'+n+'.animation.type'] || '';
  pg.animDur = parseInt(C['page.'+n+'.animation.duration']) || 300;
  var contentNums = [];
  Object.keys(C).forEach(function(k) {
    var m = k.match(new RegExp('^page\\.'+n+'\\.content\\.(\\d+)'));
    if (m && contentNums.indexOf(parseInt(m[1])) === -1) contentNums.push(parseInt(m[1]));
  });
  contentNums.forEach(function(y) {
    var ct = {type:'content', idx:y, text:'', align:'', style:'', url:'', enter:true, order:0};
    ct.text = C['page.'+n+'.content.'+y] || '';
    ct.align = C['page.'+n+'.content.'+y+'.align'] || '';
    ct.style = C['page.'+n+'.content.'+y+'.style'] || '';
    ct.url = C['page.'+n+'.content.'+y+'.url'] || '';
    ct.enter = C['page.'+n+'.content.'+y+'.enter'] !== 'false';
    ct.order = getKeyOrder('page.'+n+'.content.'+y);
    pg.elements.push(ct);
  });
  if (contentNums.length === 0 && C['page.'+n+'.content']) {
    pg.elements.push({type:'content', idx:1, text:C['page.'+n+'.content'], align:'', style:'', order:getKeyOrder('page.'+n+'.content')});
  }
  var optNums = [];
  Object.keys(C).forEach(function(k) {
    var m = k.match(new RegExp('^page\\.'+n+'\\.options\\.(\\d+)\\.'));
    if (m && optNums.indexOf(parseInt(m[1])) === -1) optNums.push(parseInt(m[1]));
  });
  optNums.forEach(function(y) {
    var opt = {type:'option', idx:y, title:'', options:[], defaultIdx:0, key:'', order:0};
    opt.title = C['page.'+n+'.options.'+y+'.title'] || '';
    opt.key = C['page.'+n+'.options.'+y+'.key'] || 'option'+y;
    opt.defaultIdx = parseInt(C['page.'+n+'.options.'+y+'.default'] || '1') - 1;
    opt.order = getKeyOrder('page.'+n+'.options.'+y+'.title');
    var optionNums = [];
    Object.keys(C).forEach(function(k) {
      var m = k.match(new RegExp('^page\\.'+n+'\\.options\\.'+y+'\\.option\\.(\\d+)$'));
      if (m) optionNums.push(parseInt(m[1]));
    });
    optionNums.sort(function(a,b){return a-b;});
    optionNums.forEach(function(z) {
      opt.options.push(C['page.'+n+'.options.'+y+'.option.'+z] || '');
    });
    pg.elements.push(opt);
  });
  var inputNums = [];
  Object.keys(C).forEach(function(k) {
    var m = k.match(new RegExp('^page\\.'+n+'\\.input\\.(\\d+)\\.'));
    if (m && inputNums.indexOf(parseInt(m[1])) === -1) inputNums.push(parseInt(m[1]));
  });
  inputNums.forEach(function(y) {
    var inp = {type:'input', idx:y, title:'', desc:'', key:'', nullable:false, order:0};
    inp.title = C['page.'+n+'.input.'+y+'.title'] || '';
    inp.desc = C['page.'+n+'.input.'+y+'.desc'] || '';
    inp.key = C['page.'+n+'.input.'+y+'.key'] || 'input'+y;
    inp.nullable = C['page.'+n+'.input.'+y+'.nullable'] === 'true';
    inp.order = getKeyOrder('page.'+n+'.input.'+y+'.title');
    pg.elements.push(inp);
  });
  pg.elements.sort(function(a,b){return a.order - b.order;});
  pages.push(pg);
});
if (pages.length === 0) {
  pages.push({n:1, title:'', elements:[], nextContent:'完成', lastContent:'上一页', hideContent:'隐藏', bgColor:'', modalColor:'', btnColor:'', defaultAlign:'', defaultStyle:'', animType:'', animDur:300});
}
var currentPage = 0;
var data = {};
function render() {
  var pg = pages[currentPage];
  var isFirst = currentPage === 0;
  var isLast = currentPage === pages.length - 1;
  var nextText = pg.nextContent || (isLast ? '完成' : '下一页');
  if (pg.bgColor) document.documentElement.style.setProperty('--bg', '#'+pg.bgColor);
  else document.documentElement.style.setProperty('--bg', '#'+bgColor);
  if (pg.modalColor) document.documentElement.style.setProperty('--modal', '#'+pg.modalColor);
  else document.documentElement.style.setProperty('--modal', '#'+modalColor);
  if (pg.btnColor) document.documentElement.style.setProperty('--btn', '#'+pg.btnColor);
  else document.documentElement.style.setProperty('--btn', '#'+btnColor);
  var html = '<div class="modal-header">';
  if (pg.title) html += '<h1>'+esc(pg.title)+'</h1>';
  html += '</div><div class="modal-content">';
  pg.elements.forEach(function(el) {
    if (el.type === 'content') {
      var align = el.align || pg.defaultAlign || globalAlign;
      var style = el.style || pg.defaultStyle || globalStyle;
      var cls = 'desc align-' + align;
      var isUrl = false;
      if (style) {
        style.split('\\').forEach(function(s) {
          if (s) cls += ' style-' + s;
          if (s === 'url') isUrl = true;
        });
      }
      if (!el.enter) cls += ' no-enter';
      if (isUrl && el.url) {
        html += '<p class="'+cls+'" data-url="'+esc(el.url)+'">'+esc(el.text)+'</p>';
      } else {
        html += '<p class="'+cls+'">'+esc(el.text)+'</p>';
      }
    } else if (el.type === 'option') {
      html += '<div class="form-group">';
      if (el.title) html += '<label>'+esc(el.title)+'</label>';
      html += '<select data-type="option" data-key="'+esc(el.key)+'">';
      el.options.forEach(function(o, j) {
        var sel = j === el.defaultIdx ? ' selected' : '';
        html += '<option value="'+esc(o)+'"'+sel+'>'+esc(o)+'</option>';
      });
      html += '</select></div>';
    } else if (el.type === 'input') {
      html += '<div class="form-group">';
      if (el.title) html += '<label>'+esc(el.title)+'</label>';
      html += '<input type="text" data-type="input" data-key="'+esc(el.key)+'" data-nullable="'+el.nullable+'" placeholder="'+esc(el.desc)+'">';
      html += '</div>';
    }
  });
  html += '</div><div class="modal-footer">';
  if (!isFirst) html += '<button class="btn btn-prev" id="prevBtn">'+esc(pg.lastContent)+'</button>';
  html += '<button class="btn btn-secondary" id="hideBtn">'+esc(pg.hideContent)+'</button>';
  html += '<button class="btn btn-primary" id="nextBtn">'+esc(nextText)+'</button>';
  html += '</div>';
  document.getElementById('root').innerHTML = html;
  if (!isFirst) document.getElementById('prevBtn').onclick = prev;
  document.getElementById('nextBtn').onclick = next;
  document.getElementById('hideBtn').onclick = hide;
  document.querySelectorAll('[data-url]').forEach(function(el) {
    el.onclick = function() {
      var url = el.getAttribute('data-url');
      if (url.indexOf('https://github.com/Nixdorfer') === 0) {
        window.open(url, '_blank');
      } else {
        showUrlConfirm(url);
      }
    };
  });
}
function esc(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function showUrlConfirm(url) {
  var overlay = document.createElement('div');
  overlay.className = 'url-confirm';
  overlay.innerHTML = '<div class="url-confirm-box"><div class="url-confirm-title">您确认要打开这个链接吗？</div><div class="url-confirm-link">'+esc(url)+'</div><div class="url-confirm-warn">打开不安全的链接可能导致安全风险！</div><div class="url-confirm-btns"><button class="url-confirm-close" id="ucClose">关闭(5)</button><button class="url-confirm-ok" id="ucOk">确定</button></div></div>';
  document.body.appendChild(overlay);
  var countdown = 5;
  var closeBtn = document.getElementById('ucClose');
  var okBtn = document.getElementById('ucOk');
  var timer = setInterval(function() {
    countdown--;
    closeBtn.textContent = '关闭(' + countdown + ')';
    if (countdown <= 0) {
      clearInterval(timer);
      overlay.remove();
    }
  }, 1000);
  closeBtn.onclick = function() { clearInterval(timer); overlay.remove(); };
  okBtn.onclick = function() { clearInterval(timer); overlay.remove(); window.open(url, '_blank'); };
}
function collectData() {
  var selects = document.querySelectorAll('select[data-type="option"]');
  selects.forEach(function(s) {
    data[s.getAttribute('data-key')] = s.value;
  });
  var inputs = document.querySelectorAll('input[data-type="input"]');
  inputs.forEach(function(inp) {
    data[inp.getAttribute('data-key')] = inp.value;
  });
}
function validate() {
  var inputs = document.querySelectorAll('input[data-type="input"]');
  for (var i = 0; i < inputs.length; i++) {
    var inp = inputs[i];
    if (inp.getAttribute('data-nullable') !== 'true' && !inp.value.trim()) {
      inp.focus();
      return false;
    }
  }
  return true;
}
function applyAnim(pg) {
  var r = document.getElementById('root');
  r.className = 'container';
  if (pg.animType && pg.animType !== 'none') {
    document.documentElement.style.setProperty('--dur', pg.animDur + 'ms');
    void r.offsetWidth;
    r.className = 'container anim-' + pg.animType;
  }
}
function prev() {
  collectData();
  if (currentPage > 0) {
    currentPage--;
    render();
  }
}
function next() {
  if (!validate()) return;
  collectData();
  var prevPg = pages[currentPage];
  if (currentPage < pages.length - 1) {
    currentPage++;
    render();
    applyAnim(prevPg);
  } else {
    var msg = Object.keys(data).map(function(k) {
      return k + '=' + data[k];
    }).join(';');
    if (prevPg.animType && prevPg.animType !== 'none') {
      var r = document.getElementById('root');
      document.documentElement.style.setProperty('--dur', prevPg.animDur + 'ms');
      r.style.animation = 'a' + prevPg.animType.charAt(0).toUpperCase() + prevPg.animType.slice(1) + ' ' + prevPg.animDur + 'ms ease-out reverse';
      setTimeout(function() { parent.postMessage({t:'done', d:data, msg:msg}, '*'); }, prevPg.animDur);
    } else {
      parent.postMessage({t:'done', d:data, msg:msg}, '*');
    }
  }
}
function hide() {
  parent.postMessage({t:'cancel'}, '*');
}
render();
})();
</script>
</body>
</html>
