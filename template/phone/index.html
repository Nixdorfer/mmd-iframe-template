<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#000;color:#fff;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}
.phone{position:relative;transform-origin:center}
.phone-frame{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100;pointer-events:none}
.phone-screen{position:absolute;top:42px;left:27px;width:486px;height:1087px;border-radius:70px;overflow:hidden;background:#111}
.phone-cursor{position:absolute;width:24px;height:24px;border-radius:50%;background:rgba(255,255,255,.4);pointer-events:none;z-index:99;opacity:0;transform:translate(-50%,-50%);transition:opacity .15s}
.phone-cursor.show{opacity:1}
.phone-cursor.active{background:rgba(255,255,255,.7)}
.home{height:100%;display:flex;flex-direction:column;background-size:cover;background-position:center}
.home-grid{flex:1;display:grid;grid-template-columns:repeat(4,1fr);gap:16px;padding:60px 24px 24px;align-content:start}
.app-icon{display:flex;flex-direction:column;align-items:center;cursor:pointer;gap:6px}
.app-icon img{width:64px;height:64px;border-radius:16px;background:#222}
.app-icon span{color:#fff;font-size:13px;text-shadow:0 1px 3px rgba(0,0,0,.5)}
.nav-bar{height:56px;display:flex;justify-content:space-around;align-items:center;background:rgba(0,0,0,.4)}
.nav-btn{width:48px;height:48px;display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:.7}
.nav-btn:hover{opacity:1}
.nav-btn img{width:28px;height:28px;filter:invert(1)}
.app-view{position:absolute;top:0;left:0;width:100%;height:100%;background:#111;transform:scale(0);opacity:0;transition:transform .3s,opacity .3s;display:flex;flex-direction:column}
.app-view.open{transform:scale(1);opacity:1}
.app-header{height:56px;display:flex;align-items:center;padding:0 16px;background:#1a1a1a;gap:12px;flex-shrink:0}
.app-header img{width:24px;height:24px}
.app-header span{font-size:18px;font-weight:bold}
.app-body{flex:1;overflow-y:auto;padding:16px}
.app-nav{height:56px;display:flex;justify-content:space-around;align-items:center;background:rgba(0,0,0,.6);flex-shrink:0}
.setting-item{display:flex;align-items:center;padding:16px;background:#1a1a1a;border-radius:12px;margin-bottom:12px}
.setting-item label{flex:1;font-size:15px}
.setting-item input[type=range]{width:120px}
.setting-toggle{width:48px;height:28px;background:#333;border-radius:14px;position:relative;cursor:pointer}
.setting-toggle.on{background:#166d3b}
.setting-toggle::after{content:'';position:absolute;top:2px;left:2px;width:24px;height:24px;background:#fff;border-radius:50%;transition:left .2s}
.setting-toggle.on::after{left:22px}
.album-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:2px}
.album-item{aspect-ratio:1;overflow:hidden;cursor:pointer}
.album-item img{width:100%;height:100%;object-fit:cover}
.photo-view{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;z-index:50;display:flex;flex-direction:column}
.photo-view .header{height:56px;display:flex;align-items:center;padding:0 16px;gap:12px}
.photo-view .header .back{cursor:pointer;font-size:20px}
.photo-view img{flex:1;object-fit:contain}
.map-view{height:100%;background-size:cover;background-position:center;position:relative}
.map-marker{position:absolute;width:24px;height:24px;background:#f00;border-radius:50%;transform:translate(-50%,-50%);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff}
.camera-view{height:100%;display:flex;flex-direction:column;background:#000}
.camera-finder{flex:1;display:flex;align-items:center;justify-content:center;border:2px solid #fff;margin:24px;border-radius:12px}
.camera-btn{width:72px;height:72px;background:#fff;border-radius:50%;margin:24px auto;cursor:pointer}
.calendar-view{padding:16px}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;text-align:center}
.calendar-day{padding:8px;border-radius:8px;cursor:pointer}
.calendar-day.marked{background:#166d3b}
.calendar-day.today{border:2px solid #fff}
.browser-view{display:flex;flex-direction:column;height:100%}
.browser-url{padding:12px;background:#1a1a1a;border-radius:8px;margin:12px;font-size:13px;color:#888;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.browser-content{flex:1;background:#fff}
.browser-content img{width:100%;height:100%;object-fit:cover}
.grid-view{display:grid;gap:4px;padding:8px}
.grid-slot{aspect-ratio:1;background:#1a1a1a;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
.grid-slot img{width:60%;height:60%;object-fit:contain}
.grid-slot .count{position:absolute;bottom:4px;right:4px;font-size:11px;background:rgba(0,0,0,.6);padding:2px 6px;border-radius:4px}
.chat-list{display:flex;flex-direction:column;gap:8px}
.chat-item{display:flex;align-items:center;gap:12px;padding:12px;background:#1a1a1a;border-radius:12px;cursor:pointer}
.chat-item img{width:48px;height:48px;border-radius:50%;background:#333}
.chat-item .info{flex:1}
.chat-item .name{font-weight:bold}
.chat-item .msg{font-size:13px;color:#888}
.chat-view{display:flex;flex-direction:column;height:100%}
.chat-messages{flex:1;padding:16px;display:flex;flex-direction:column;gap:8px;overflow-y:auto}
.chat-bubble{max-width:70%;padding:10px 14px;border-radius:16px;font-size:14px}
.chat-bubble.me{background:#166d3b;align-self:flex-end;border-bottom-right-radius:4px}
.chat-bubble.other{background:#333;align-self:flex-start;border-bottom-left-radius:4px}
.brainwash-view{height:100%;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:bold;text-align:center;padding:24px}
.brainwash-view.scroll{animation:brainScroll 3s linear infinite}
.brainwash-view.flash{animation:brainFlash 1s ease infinite}
@keyframes brainScroll{0%{transform:translateY(100%)}100%{transform:translateY(-100%)}}
@keyframes brainFlash{0%,100%{opacity:1}50%{opacity:0}}
.database-view{display:flex;flex-direction:column;gap:8px}
.database-cat{background:#1a1a1a;border-radius:12px;overflow:hidden}
.database-cat-hd{padding:14px 16px;cursor:pointer;display:flex;justify-content:space-between}
.database-cat-bd{max-height:0;overflow:hidden;transition:max-height .3s}
.database-cat-bd.open{max-height:500px}
.database-item{padding:12px 16px;border-top:1px solid #333}
.database-item .title{font-weight:bold;margin-bottom:4px}
.database-item .content{font-size:13px;color:#888}
.clock-view{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}
.clock-face{width:200px;height:200px;border:4px solid #fff;border-radius:50%;position:relative}
.clock-hand{position:absolute;bottom:50%;left:50%;transform-origin:bottom center;background:#fff}
.clock-hand.hour{width:4px;height:50px;margin-left:-2px}
.clock-hand.minute{width:3px;height:70px;margin-left:-1.5px}
.clock-hand.second{width:1px;height:80px;background:#f00}
.clock-digital{font-size:48px;margin-top:24px;font-family:monospace}
.mail-list{display:flex;flex-direction:column;gap:8px}
.mail-item{padding:14px;background:#1a1a1a;border-radius:12px;cursor:pointer}
.mail-item .from{font-weight:bold;margin-bottom:4px}
.mail-item .subject{margin-bottom:4px}
.mail-item .time{font-size:12px;color:#666}
.mail-detail{padding:16px}
.mail-detail .from{font-size:13px;color:#888;margin-bottom:8px}
.mail-detail .subject{font-size:20px;font-weight:bold;margin-bottom:16px}
.mail-detail .body{line-height:1.6}
.phone-dial{display:flex;flex-direction:column;align-items:center;padding:24px}
.phone-number{font-size:32px;margin-bottom:24px;min-height:48px}
.phone-pad{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.phone-key{width:72px;height:72px;background:#1a1a1a;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer}
.phone-key:hover{background:#333}
.phone-call{width:72px;height:72px;background:#166d3b;border-radius:50%;margin-top:24px;cursor:pointer}
.contacts-list{display:flex;flex-direction:column;gap:8px}
.contact-item{display:flex;align-items:center;gap:12px;padding:12px;background:#1a1a1a;border-radius:12px}
.contact-item img{width:48px;height:48px;border-radius:50%;background:#333}
.contact-item .name{font-weight:bold}
.contact-item .number{font-size:13px;color:#888}
.wallet-view{padding:16px}
.wallet-balance{text-align:center;padding:32px;background:#1a1a1a;border-radius:16px;margin-bottom:16px}
.wallet-balance .amount{font-size:48px;font-weight:bold}
.wallet-balance .currency{font-size:16px;color:#888}
.wallet-tx{padding:12px;background:#1a1a1a;border-radius:12px;margin-bottom:8px;display:flex;justify-content:space-between}
.wallet-tx .desc{font-weight:bold}
.wallet-tx .amount{color:#166d3b}
.wallet-tx .amount.minus{color:#f66}
</style>
</head>
<body>
<div class="phone" id="phone">
<img class="phone-frame" src="https://github.com/Nixdorfer/mmd-iframe-template/blob/main/icon/phone.png?raw=true">
<div class="phone-screen" id="screen"></div>
<div class="phone-cursor" id="cursor"></div>
</div>
<script>
L.load(['util'],function(){
var C={},G,A,cur=null,sub=null,S=document.getElementById('screen'),CR=document.getElementById('cursor'),P=document.getElementById('phone');
var APPS={setting:{n:'设置',i:'setting-line'},map:{n:'地图',i:'map-line'},album:{n:'相册',i:'album-line'},camera:{n:'相机',i:'camera-line'},calendar:{n:'日历',i:'calendar-line'},browser:{n:'浏览器',i:'browser-fill'},backpack:{n:'背包',i:'backpack-line'},warehouse:{n:'仓库',i:'warehouse-line'},wechat:{n:'微信',i:'wechat-line'},brainwash:{n:'洗脑',i:'brain-fill'},database:{n:'知识',i:'book-line'},clock:{n:'时钟',i:'clock-line'},mail:{n:'邮件',i:'mail-line'},phone:{n:'电话',i:'phone-line'},wallet:{n:'钱包',i:'wallet-line'}};
var ICON='https://github.com/Nixdorfer/mmd-iframe-template/blob/main/icon/';
function init(){try{C=JSON.parse(decodeURIComponent(escape(atob(L.b64||'e30='))))}catch(e){C={}}G=C.global||{};A=C.apps||{};applyScale();render()}
function applyScale(){var s=(G.scale||100)/100;P.style.transform='scale('+s+')';P.style.width=540*s+'px';P.style.height=1170*s+'px'}
function render(){if(cur)renderApp(cur);else renderHome()}
function renderHome(){var h='<div class="home"'+(G.wallpaper?' style="background-image:url('+(G.wallpaper.charAt(0)==='/'?'https://r2.sexyai.top':'')+G.wallpaper+')"':'')+'><div class="home-grid">';Object.keys(APPS).forEach(function(k){if(A[k]&&A[k].enabled===false)return;h+='<div class="app-icon" data-app="'+k+'"><img src="'+ICON+APPS[k].i+'.png?raw=true"><span>'+APPS[k].n+'</span></div>'});h+='</div><div class="nav-bar"><div class="nav-btn" data-nav="back"><img src="'+ICON+'back-line.png?raw=true"></div><div class="nav-btn" data-nav="home"><img src="'+ICON+'circle-line.png?raw=true"></div><div class="nav-btn" data-nav="menu"><img src="'+ICON+'menu-line.png?raw=true"></div></div></div>';S.innerHTML=h;bindHome()}
function bindHome(){S.querySelectorAll('.app-icon').forEach(function(el){el.onclick=function(e){var k=el.dataset.app,r=el.getBoundingClientRect(),sr=S.getBoundingClientRect();openApp(k,r.left-sr.left+r.width/2,r.top-sr.top+r.height/2)}});S.querySelectorAll('.nav-btn').forEach(function(el){el.onclick=function(){if(el.dataset.nav==='home'){cur=null;sub=null;render()}}})}
function openApp(k,ox,oy){cur=k;var h=renderAppView(k);S.innerHTML=h;var v=S.querySelector('.app-view');if(v){v.style.transformOrigin=ox+'px '+oy+'px';setTimeout(function(){v.classList.add('open')},10)}bindApp(k)}
function closeApp(){cur=null;sub=null;render()}
function renderAppView(k){var a=A[k]||{},d=APPS[k];var h='<div class="app-view"><div class="app-header"><img src="'+ICON+d.i+'.png?raw=true"><span>'+d.n+'</span></div><div class="app-body">';h+=R[k]?R[k](a):('<div style="text-align:center;padding:48px;color:#666">'+d.n+'</div>');h+='</div><div class="app-nav"><div class="nav-btn" data-nav="back"><img src="'+ICON+'back-line.png?raw=true"></div><div class="nav-btn" data-nav="home"><img src="'+ICON+'circle-line.png?raw=true"></div><div class="nav-btn" data-nav="menu"><img src="'+ICON+'menu-line.png?raw=true"></div></div></div>';return h}
function bindApp(k){S.querySelectorAll('.nav-btn').forEach(function(el){el.onclick=function(){var n=el.dataset.nav;if(n==='home')closeApp();else if(n==='back'){if(sub){sub=null;var v=S.querySelector('.app-view');if(v){v.querySelector('.app-body').innerHTML=R[k]?R[k](A[k]||{}):'';B[k]&&B[k](A[k]||{})}}else closeApp()}}});B[k]&&B[k](A[k]||{})}
var R={
setting:function(a){var h='';(a.items||[]).forEach(function(it,i){h+='<div class="setting-item"><label>'+U.esc(it.label||'')+'</label>';if(it.type==='slider')h+='<input type="range" min="'+(it.min||0)+'" max="'+(it.max||100)+'" value="'+(it.value||50)+'" data-i="'+i+'">';else h+='<div class="setting-toggle'+(it.value?' on':'')+'" data-i="'+i+'"></div>';h+='</div>'});return h||'<div style="color:#666;text-align:center">无设置项</div>'},
map:function(a){var bg=a.bgImage?(a.bgImage.charAt(0)==='/'?'https://r2.sexyai.top':'')+a.bgImage:'';var h='<div class="map-view"'+(bg?' style="background-image:url('+bg+')"':'')+'>';(a.markers||[]).forEach(function(m,i){h+='<div class="map-marker" style="left:'+m.x+'%;top:'+m.y+'%" data-i="'+i+'">'+(i+1)+'</div>'});return h+'</div>'},
album:function(a){var h='<div class="album-grid">';(a.photos||[]).forEach(function(p,i){var u=p.url?(p.url.charAt(0)==='/'?'https://r2.sexyai.top':'')+p.url:'';if(u)h+='<div class="album-item" data-i="'+i+'"><img src="'+u+'"></div>'});return h+'</div>'},
camera:function(a){return'<div class="camera-view"><div class="camera-finder">'+(a.frameImage?'<img src="'+(a.frameImage.charAt(0)==='/'?'https://r2.sexyai.top':'')+a.frameImage+'" style="max-width:100%;max-height:100%">':'')+'</div><div class="camera-btn"></div></div>'},
calendar:function(a){var d=new Date(),y=d.getFullYear(),m=d.getMonth(),first=new Date(y,m,1).getDay(),days=new Date(y,m+1,0).getDate();var h='<div class="calendar-view"><div style="text-align:center;font-size:18px;margin-bottom:16px">'+y+'年'+(m+1)+'月</div><div class="calendar-grid"><div>日</div><div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div>';for(var i=0;i<first;i++)h+='<div></div>';for(var i=1;i<=days;i++){var ds=y+'-'+(m+1<10?'0':'')+(m+1)+'-'+(i<10?'0':'')+i;var marked=(a.marked||[]).indexOf(ds)>-1;var today=i===d.getDate();h+='<div class="calendar-day'+(marked?' marked':'')+(today?' today':'')+'" data-d="'+ds+'">'+i+'</div>'}h+='</div>';var ev=a.events||{};h+='<div style="margin-top:16px">';Object.keys(ev).forEach(function(k){h+='<div style="padding:8px;background:#1a1a1a;border-radius:8px;margin-bottom:8px"><div style="font-size:12px;color:#666">'+k+'</div><div>'+U.esc(ev[k])+'</div></div>'});return h+'</div></div>'},
browser:function(a){var ss=a.screenshot?(a.screenshot.charAt(0)==='/'?'https://r2.sexyai.top':'')+a.screenshot:'';return'<div class="browser-view"><div class="browser-url">'+U.esc(a.url||'https://')+'</div><div class="browser-content">'+(ss?'<img src="'+ss+'">':'')+'</div></div>'},
backpack:function(a){var c=a.cols||4,r=a.rows||6;var h='<div class="grid-view" style="grid-template-columns:repeat('+c+',1fr)">';for(var i=0;i<c*r;i++){var it=(a.items||[]).find(function(x){return x.slot===i});h+='<div class="grid-slot">';if(it&&it.icon){var ic=it.icon.charAt(0)==='/'?'https://r2.sexyai.top'+it.icon:it.icon;h+='<img src="'+ic+'">';if(it.count>1)h+='<span class="count">'+it.count+'</span>'}h+='</div>'}return h+'</div>'},
warehouse:function(a){var c=a.cols||6,r=a.rows||8;var h='<div class="grid-view" style="grid-template-columns:repeat('+c+',1fr)">';for(var i=0;i<c*r;i++){var it=(a.items||[]).find(function(x){return x.slot===i});h+='<div class="grid-slot">';if(it&&it.icon){var ic=it.icon.charAt(0)==='/'?'https://r2.sexyai.top'+it.icon:it.icon;h+='<img src="'+ic+'">';if(it.count>1)h+='<span class="count">'+it.count+'</span>'}h+='</div>'}return h+'</div>'},
wechat:function(a){var h='<div class="chat-list">';(a.chats||[]).forEach(function(c,i){var av=c.avatar?(c.avatar.charAt(0)==='/'?'https://r2.sexyai.top':'')+c.avatar:'';h+='<div class="chat-item" data-i="'+i+'">'+(av?'<img src="'+av+'">':'<div style="width:48px;height:48px;background:#333;border-radius:50%"></div>')+'<div class="info"><div class="name">'+U.esc(c.name||'')+'</div><div class="msg">'+U.esc(c.lastMsg||'')+'</div></div></div>'});return h+'</div>'},
brainwash:function(a){var ef=a.effect||'scroll';return'<div class="brainwash-view '+ef+'" style="animation-duration:'+(a.speed||2)+'s">'+(a.texts||[]).join('<br>')+'</div>'},
database:function(a){var h='<div class="database-view">';(a.categories||[]).forEach(function(cat,i){h+='<div class="database-cat"><div class="database-cat-hd" data-i="'+i+'">'+U.esc(cat.name||'')+'<span>▶</span></div><div class="database-cat-bd">';(cat.items||[]).forEach(function(it){h+='<div class="database-item"><div class="title">'+U.esc(it.title||'')+'</div><div class="content">'+U.esc(it.content||'')+'</div></div>'});h+='</div></div>'});return h+'</div>'},
clock:function(a){var h='<div class="clock-view"><div class="clock-face"><div class="clock-hand hour"></div><div class="clock-hand minute"></div><div class="clock-hand second"></div></div><div class="clock-digital"></div></div>';return h},
mail:function(a){var h='<div class="mail-list">';(a.mails||[]).forEach(function(m,i){h+='<div class="mail-item" data-i="'+i+'"><div class="from">'+U.esc(m.from||'')+'</div><div class="subject">'+U.esc(m.subject||'')+'</div><div class="time">'+U.esc(m.time||'')+'</div></div>'});return h+'</div>'},
phone:function(a){return'<div class="phone-dial"><div class="phone-number" id="dialNum"></div><div class="phone-pad"><div class="phone-key" data-k="1">1</div><div class="phone-key" data-k="2">2</div><div class="phone-key" data-k="3">3</div><div class="phone-key" data-k="4">4</div><div class="phone-key" data-k="5">5</div><div class="phone-key" data-k="6">6</div><div class="phone-key" data-k="7">7</div><div class="phone-key" data-k="8">8</div><div class="phone-key" data-k="9">9</div><div class="phone-key" data-k="*">*</div><div class="phone-key" data-k="0">0</div><div class="phone-key" data-k="#">#</div></div><div class="phone-call"></div></div><div class="contacts-list" style="margin-top:24px">';var h='';(a.contacts||[]).forEach(function(c){var av=c.avatar?(c.avatar.charAt(0)==='/'?'https://r2.sexyai.top':'')+c.avatar:'';h+='<div class="contact-item">'+(av?'<img src="'+av+'">':'<div style="width:48px;height:48px;background:#333;border-radius:50%"></div>')+'<div><div class="name">'+U.esc(c.name||'')+'</div><div class="number">'+U.esc(c.number||'')+'</div></div></div>'});return h+'</div>'},
wallet:function(a){var h='<div class="wallet-view"><div class="wallet-balance"><div class="amount">'+((a.balance||0).toLocaleString())+'</div><div class="currency">'+U.esc(a.currency||'金币')+'</div></div>';(a.transactions||[]).forEach(function(t){h+='<div class="wallet-tx"><div><div class="desc">'+U.esc(t.desc||'')+'</div><div style="font-size:12px;color:#666">'+U.esc(t.time||'')+'</div></div><div class="amount'+(t.amount<0?' minus':'')+'">'+((t.amount||0)>0?'+':'')+t.amount+'</div></div>'});return h+'</div>'}
};
var B={
setting:function(a){S.querySelectorAll('.setting-toggle').forEach(function(el){el.onclick=function(){el.classList.toggle('on')}})},
album:function(a){S.querySelectorAll('.album-item').forEach(function(el){el.onclick=function(){var i=parseInt(el.dataset.i),p=(a.photos||[])[i];if(!p)return;sub='photo';var u=p.url?(p.url.charAt(0)==='/'?'https://r2.sexyai.top':'')+p.url:'';S.querySelector('.app-body').innerHTML='<div class="photo-view"><div class="header"><span class="back">◀</span><span>'+U.esc(p.time||'')+'</span></div><img src="'+u+'"></div>';S.querySelector('.photo-view .back').onclick=function(){sub=null;S.querySelector('.app-body').innerHTML=R.album(a);B.album(a)}}})},
database:function(a){S.querySelectorAll('.database-cat-hd').forEach(function(el){el.onclick=function(){el.nextElementSibling.classList.toggle('open');el.querySelector('span').textContent=el.nextElementSibling.classList.contains('open')?'▼':'▶'}})},
clock:function(a){function upd(){var d=new Date();if(a.mode==='fixed'&&a.fixedTime){var p=a.fixedTime.split(':');d=new Date();d.setHours(parseInt(p[0])||0,parseInt(p[1])||0,0)}var h=d.getHours()%12,m=d.getMinutes(),s=d.getSeconds();var hh=S.querySelector('.clock-hand.hour'),mh=S.querySelector('.clock-hand.minute'),sh=S.querySelector('.clock-hand.second'),dg=S.querySelector('.clock-digital');if(hh)hh.style.transform='rotate('+(h*30+m/2)+'deg)';if(mh)mh.style.transform='rotate('+(m*6)+'deg)';if(sh)sh.style.transform='rotate('+(s*6)+'deg)';if(dg)dg.textContent=(d.getHours()<10?'0':'')+d.getHours()+':'+(d.getMinutes()<10?'0':'')+d.getMinutes()+':'+(d.getSeconds()<10?'0':'')+d.getSeconds()}upd();if(a.mode!=='fixed')setInterval(upd,1000)},
mail:function(a){S.querySelectorAll('.mail-item').forEach(function(el){el.onclick=function(){var i=parseInt(el.dataset.i),m=(a.mails||[])[i];if(!m)return;sub='detail';S.querySelector('.app-body').innerHTML='<div class="mail-detail"><div class="from">来自: '+U.esc(m.from||'')+'</div><div class="subject">'+U.esc(m.subject||'')+'</div><div class="body">'+U.esc(m.body||'').replace(/\n/g,'<br>')+'</div></div>'}})},
phone:function(a){var num='';S.querySelectorAll('.phone-key').forEach(function(el){el.onclick=function(){num+=el.dataset.k;var dn=S.querySelector('#dialNum');if(dn)dn.textContent=num}})},
wechat:function(a){S.querySelectorAll('.chat-item').forEach(function(el){el.onclick=function(){var i=parseInt(el.dataset.i),c=(a.chats||[])[i];if(!c)return;sub='chat';var h='<div class="chat-view"><div class="chat-messages">';(c.messages||[]).forEach(function(m){h+='<div class="chat-bubble '+(m.from==='me'?'me':'other')+'">'+U.esc(m.text||'')+'</div>'});h+='</div></div>';S.querySelector('.app-body').innerHTML=h}})}
};
S.onmousemove=function(e){var r=S.getBoundingClientRect();CR.style.left=(e.clientX-r.left)+'px';CR.style.top=(e.clientY-r.top)+'px';CR.classList.add('show')};
S.onmouseleave=function(){CR.classList.remove('show')};
S.onmousedown=function(){CR.classList.add('active')};
S.onmouseup=function(){CR.classList.remove('active')};
var dragY=null,dragST=0;
S.addEventListener('mousedown',function(e){var b=S.querySelector('.app-body');if(b){dragY=e.clientY;dragST=b.scrollTop}});
S.addEventListener('mousemove',function(e){if(dragY!==null){var b=S.querySelector('.app-body');if(b)b.scrollTop=dragST-(e.clientY-dragY)}});
S.addEventListener('mouseup',function(){dragY=null});
S.addEventListener('mouseleave',function(){dragY=null});
init();
if(L.edit)window.phoneRender=function(d){C=d;G=C.global||{};A=C.apps||{};applyScale();render()};
});
</script>
</body>
</html>
