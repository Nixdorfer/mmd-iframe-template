<!DOCTYPE html><html><head><meta charset="utf-8"><style>*{margin:0;padding:0;box-sizing:border-box}body{background:#050505;font-family:system-ui,sans-serif}</style></head><body>
<script>
window.L={loaded:{},base:'https://raw.githubusercontent.com/Nixdorfer/mmd-iframe-template/refs/heads/main/',edit:false,project:'',char:'',user:'',b64:'',res:'',platform:'',load:function(libs,cb){var self=this,pending=libs.filter(function(n){return!self.loaded[n]});if(!pending.length)return cb&&cb();var c=pending.length;pending.forEach(function(n){self.loaded[n]=1;fetch(self.base+'library/'+n+'.js?t='+Date.now()).then(function(r){return r.text()}).then(function(t){new Function(t)();if(--c===0&&cb)cb()})})}};
parent.postMessage({t:'ping'},'*');window.addEventListener('message',function h(ev){if(!ev.data||ev.data.t!=='init')return;window.removeEventListener('message',h);var p=ev.data.p,r=ev.data.r;L.res=r||window.innerWidth+'x'+window.innerHeight;var w=window.innerWidth,hh=window.innerHeight,rt=w/hh;L.platform=Math.abs(rt-16/9)<Math.abs(rt-9/19)?'pc':'mobile';if(!p){parent.postMessage({t:'error',msg:'参数为空'},'*');return}var m=p.match(/^(?:(EDIT):)?([^:]+):(.+)$/);if(!m){parent.postMessage({t:'error',msg:'格式错误'},'*');return}L.edit=!!m[1];L.project=m[2];var params=m[3].split(';;');L.char=params[0]||'';L.user=params[1]||'';L.b64=params[2]||'';document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;color:#fff">加载中...</div>';fetch(L.base+'navigator.json?t='+Date.now(),{cache:'no-store'}).then(function(r){return r.json()}).then(function(nav){var proj=nav.projects[L.project];if(!proj){parent.postMessage({t:'error',msg:'未找到: '+L.project},'*');return}fetch(L.base+proj.index+'?t='+Date.now(),{cache:'no-store'}).then(function(r){return r.text()}).then(function(h){var cfg='window.L='+JSON.stringify({loaded:{},base:L.base,edit:L.edit,project:L.project,char:L.char,user:L.user,b64:L.b64,res:L.res,platform:L.platform})+';L.load=function(libs,cb){var self=this,pending=libs.filter(function(n){return!self.loaded[n]});if(!pending.length)return cb&&cb();var c=pending.length;pending.forEach(function(n){self.loaded[n]=1;fetch(self.base+"library/"+n+".js?t="+Date.now()).then(function(r){return r.text()}).then(function(t){new Function(t)();if(--c===0&&cb)cb()})})};';document.open();document.write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body><script>'+cfg+'<\/script>'+h+'</body></html>');document.close();parent.postMessage({t:'ready'},'*')}).catch(function(){parent.postMessage({t:'error',msg:'加载失败'},'*')})}).catch(function(){parent.postMessage({t:'error',msg:'导航失败'},'*')})});
</script>
</body></html>
